{# media.html #}
{% extends 'base.html' %}

{% block title %}Медиа{% endblock %}

{% block body_class %}page-media{% endblock %}

{% block content %}
        <div class="title-container">
             {# Ссылка "Создать запись" видна ТОЛЬКО авторизованным пользователям #}
            {% if current_user.is_authenticated %}
                <a class="on-page" href="{{ url_for('create') }}">Создать запись</a>
            {% endif %}
            <h1>Медиа</h1>
        </div>

        {# --- Список постов из базы данных --- #}
        <div class="posts-list mt-5"> {# Добавим отступ сверху #}
            <h2>Наши записи</h2>

            {% if posts %} {# Проверяем, есть ли посты для отображения #}
                {% for post in posts %}
                    <div class="post-item mt-4" style="border-radius: 4px; border: 3px solid #eee; padding: 20px; margin-bottom: 20px; background-color: rgba(255, 255, 255, 0.05);">
                        <h3>{{ post.title }}</h3>
                            <h5>{{ post.text }}</h5>

                         {# --- Отображаем дату и время создания в UTC+5 --- #}
                        {# Используем пользовательский фильтр format_datetime_timezone #}
                        <small style="color: #ccc; opacity: 0.7;">
                            Опубликовано: {{ post.created_at | format_datetime_timezone('Asia/Yekaterinburg', '%Y-%m-%d %H:%M') }} {# <-- Здесь используем фильтр #}
                        </small>
                        {# --- Конец отображения даты --- #}

                        <br>
                        {# автор поста: #}
                        <small>Автор: {{ post.author.username }}</small>

                        {# --- Отображаем изображение, если оно есть --- #}
                        {% if post.image_filename %} {# Проверяем, сохранено ли имя файла изображения для этого поста #}
                            {# Генерируем URL к изображению, используя url_for('static', ...) #}
                            {# Путь будет: static/post_images/имя_файла_изображения #}
                            <img src="{{ url_for('static', filename='post_images/' + post.image_filename) }}" alt="Изображение к посту" class="post-image"> {# Используем класс .post-image из style.css #}
                        {% endif %}

                        {# --- Кнопки Редактировать и Удалить (видны только авторизованным) --- #}
                        {% if current_user.is_authenticated %}
                            <div class="post-actions mt-3"> {# Добавляем небольшой отступ сверху #}
                                {# Ссылка на страницу редактирования #}
                                <a href="{{ url_for('edit', post_id=post.id) }}" class="btn btn-secondary btn-sm me-2">Редактировать</a> {# Используем классы Bootstrap для кнопок #}

                                {# Форма для удаления (отправляет POST запрос) #}
                                <form action="{{ url_for('delete', post_id=post.id) }}" method="POST" style="display:inline;"> {# display:inline; чтобы форма не переносилась на новую строку #}
                                    <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Вы уверены, что хотите удалить эту запись?');">Удалить</button> {# Подтверждение удаления #}
                                </form>
                            </div>
                        {% endif %}
                    </div>
                {% endfor %}

            {% else %} {# Если постов пока нет #}
                <p style="color: #fff; opacity: 0.8;">Пока нет опубликованных записей.</p>
            {% endif %}
        </div>
{% endblock %}
